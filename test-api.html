<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Tester - Artist Schedule Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        .test-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .test-section h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .result {
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .success {
            color: #28a745;
            font-weight: bold;
        }

        .error {
            color: #dc3545;
            font-weight: bold;
        }

        .status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .status.connected {
            background: #d4edda;
            color: #155724;
        }

        .status.disconnected {
            background: #f8d7da;
            color: #721c24;
        }

        .indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .config-section {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .config-section h3 {
            color: #856404;
            margin-bottom: 15px;
        }

        .config-section code {
            background: #fff;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9rem;
            color: #d63384;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        tr:hover {
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ API Tester</h1>
        <p class="subtitle">Test Google Calendar, Tasks & Maps APIs</p>

        <div class="config-section">
            <h3>‚öôÔ∏è C·∫•u h√¨nh hi·ªán t·∫°i</h3>
            <table>
                <tr>
                    <th>API</th>
                    <th>Status</th>
                    <th>Value</th>
                </tr>
                <tr>
                    <td>Client ID</td>
                    <td id="clientIdStatus">‚ùå</td>
                    <td><code id="clientIdValue">Ch∆∞a c·∫•u h√¨nh</code></td>
                </tr>
                <tr>
                    <td>API Key</td>
                    <td id="apiKeyStatus">‚ùå</td>
                    <td><code id="apiKeyValue">Ch∆∞a c·∫•u h√¨nh</code></td>
                </tr>
                <tr>
                    <td>Gemini Key</td>
                    <td id="geminiKeyStatus">‚ùå</td>
                    <td><code id="geminiKeyValue">Ch∆∞a c·∫•u h√¨nh</code></td>
                </tr>
            </table>
        </div>

        <div id="authStatus" class="status disconnected">
            <div class="indicator"></div>
            <span>Ch∆∞a ƒëƒÉng nh·∫≠p</span>
        </div>

        <!-- Auth Section -->
        <div class="test-section">
            <h2>üîê Authentication</h2>
            <button onclick="handleAuthClick()">ƒêƒÉng nh·∫≠p</button>
            <button onclick="handleSignoutClick()">ƒêƒÉng xu·∫•t</button>
            <div id="authResult" class="result" style="display: none;"></div>
        </div>

        <!-- Calendar API Tests -->
        <div class="test-section">
            <h2>üìÖ Google Calendar API</h2>
            <button onclick="testListEvents()">1. L·∫•y danh s√°ch s·ª± ki·ªán</button>
            <button onclick="testCreateEvent()">2. T·∫°o s·ª± ki·ªán test</button>
            <button onclick="testUpdateEvent()">3. C·∫≠p nh·∫≠t s·ª± ki·ªán</button>
            <button onclick="testDeleteEvent()">4. X√≥a s·ª± ki·ªán</button>
            <div id="calendarResult" class="result" style="display: none;"></div>
        </div>

        <!-- Tasks API Tests -->
        <div class="test-section">
            <h2>‚úÖ Google Tasks API</h2>
            <button onclick="testListTasks()">1. L·∫•y danh s√°ch tasks</button>
            <button onclick="testCreateTask()">2. T·∫°o task test</button>
            <button onclick="testCompleteTask()">3. ƒê√°nh d·∫•u ho√†n th√†nh</button>
            <button onclick="testDeleteTask()">4. X√≥a task</button>
            <div id="tasksResult" class="result" style="display: none;"></div>
        </div>

        <!-- Maps API Tests -->
        <div class="test-section">
            <h2>üó∫Ô∏è Google Maps API</h2>
            <button onclick="testLoadMap()">1. Load b·∫£n ƒë·ªì</button>
            <button onclick="testGeocoding()">2. Geocoding ƒë·ªãa ch·ªâ</button>
            <button onclick="testPlacesSearch()">3. T√¨m ƒë·ªãa ƒëi·ªÉm</button>
            <div id="mapsResult" class="result" style="display: none;"></div>
            <div id="mapContainer" style="width: 100%; height: 300px; margin-top: 15px; border-radius: 8px; overflow: hidden; display: none;"></div>
        </div>

        <!-- Gemini API Tests -->
        <div class="test-section">
            <h2>ü§ñ Gemini AI API</h2>
            <button onclick="testGeminiChat()">1. Test chat</button>
            <button onclick="testGeminiEventParsing()">2. Parse s·ª± ki·ªán t·ª´ text</button>
            <div id="geminiResult" class="result" style="display: none;"></div>
        </div>

        <!-- Integration Tests -->
        <div class="test-section">
            <h2>üîÑ Integration Tests</h2>
            <button onclick="testFullWorkflow()">Test to√†n b·ªô workflow</button>
            <div id="integrationResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js" async defer></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_MAPS_API_KEY&libraries=places"></script>

    <script>
        // ============================================
        // CONFIGURATION
        // ============================================
        const CONFIG = {
            CLIENT_ID: 'YOUR_CLIENT_ID.apps.googleusercontent.com',
            API_KEY: 'YOUR_API_KEY',
            GEMINI_API_KEY: 'YOUR_GEMINI_API_KEY',
            GEMINI_API_URL: 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent',
            SCOPES: [
                'https://www.googleapis.com/auth/calendar',
                'https://www.googleapis.com/auth/tasks',
            ].join(' '),
            DISCOVERY_DOCS: [
                'https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest',
                'https://www.googleapis.com/discovery/v1/apis/tasks/v1/rest'
            ]
        };

        let tokenClient;
        let gapiInited = false;
        let gisInited = false;
        let testEventId = null;
        let testTaskId = null;
        let map = null;

        // Check config on load
        window.onload = () => {
            checkConfig();
            gapiLoaded();
            gisLoaded();
        };

        function checkConfig() {
            // Check Client ID
            if (CONFIG.CLIENT_ID !== 'YOUR_CLIENT_ID.apps.googleusercontent.com') {
                document.getElementById('clientIdStatus').textContent = '‚úÖ';
                document.getElementById('clientIdValue').textContent = CONFIG.CLIENT_ID.substring(0, 30) + '...';
            }

            // Check API Key
            if (CONFIG.API_KEY !== 'YOUR_API_KEY') {
                document.getElementById('apiKeyStatus').textContent = '‚úÖ';
                document.getElementById('apiKeyValue').textContent = CONFIG.API_KEY.substring(0, 20) + '...';
            }

            // Check Gemini Key
            if (CONFIG.GEMINI_API_KEY !== 'YOUR_GEMINI_API_KEY') {
                document.getElementById('geminiKeyStatus').textContent = '‚úÖ';
                document.getElementById('geminiKeyValue').textContent = CONFIG.GEMINI_API_KEY.substring(0, 20) + '...';
            }
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        function gapiLoaded() {
            gapi.load('client', initializeGapiClient);
        }

        async function initializeGapiClient() {
            await gapi.client.init({
                apiKey: CONFIG.API_KEY,
                discoveryDocs: CONFIG.DISCOVERY_DOCS,
            });
            gapiInited = true;
            showResult('authResult', '‚úÖ GAPI Client initialized', 'success');
        }

        function gisLoaded() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CONFIG.CLIENT_ID,
                scope: CONFIG.SCOPES,
                callback: '',
            });
            gisInited = true;
            showResult('authResult', '‚úÖ GIS initialized', 'success');
        }

        // ============================================
        // AUTHENTICATION
        // ============================================
        function handleAuthClick() {
            tokenClient.callback = async (resp) => {
                if (resp.error !== undefined) {
                    showResult('authResult', `‚ùå Error: ${resp.error}`, 'error');
                    return;
                }
                
                document.getElementById('authStatus').className = 'status connected';
                document.getElementById('authStatus').innerHTML = '<div class="indicator"></div><span>ƒê√£ k·∫øt n·ªëi ‚úì</span>';
                showResult('authResult', `‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng!\nAccess Token: ${resp.access_token.substring(0, 50)}...`, 'success');
            };

            if (gapi.client.getToken() === null) {
                tokenClient.requestAccessToken({prompt: 'consent'});
            } else {
                tokenClient.requestAccessToken({prompt: ''});
            }
        }

        function handleSignoutClick() {
            const token = gapi.client.getToken();
            if (token !== null) {
                google.accounts.oauth2.revoke(token.access_token);
                gapi.client.setToken('');
                document.getElementById('authStatus').className = 'status disconnected';
                document.getElementById('authStatus').innerHTML = '<div class="indicator"></div><span>Ch∆∞a ƒëƒÉng nh·∫≠p</span>';
                showResult('authResult', '‚úÖ ƒê√£ ƒëƒÉng xu·∫•t', 'success');
            }
        }

        // ============================================
        // CALENDAR API TESTS
        // ============================================
        async function testListEvents() {
            try {
                const response = await gapi.client.calendar.events.list({
                    'calendarId': 'primary',
                    'timeMin': new Date().toISOString(),
                    'showDeleted': false,
                    'singleEvents': true,
                    'maxResults': 10,
                    'orderBy': 'startTime'
                });

                const events = response.result.items;
                let result = `‚úÖ T√¨m th·∫•y ${events.length} s·ª± ki·ªán:\n\n`;
                
                events.forEach((event, index) => {
                    const start = event.start.dateTime || event.start.date;
                    result += `${index + 1}. ${event.summary}\n`;
                    result += `   üìÖ ${new Date(start).toLocaleString('vi-VN')}\n`;
                    result += `   üìç ${event.location || 'Kh√¥ng c√≥ ƒë·ªãa ƒëi·ªÉm'}\n\n`;
                });

                showResult('calendarResult', result, 'success');
            } catch (err) {
                showResult('calendarResult', `‚ùå L·ªói: ${err.message}`, 'error');
            }
        }

        async function testCreateEvent() {
            try {
                const now = new Date();
                const tomorrow = new Date(now.getTime() + 24 * 60 * 60 * 1000);
                
                const event = {
                    'summary': 'üß™ Test Event from API Tester',
                    'location': 'Nh√† h√°t Th√†nh ph·ªë, H·ªì Ch√≠ Minh',
                    'description': 'ƒê√¢y l√† s·ª± ki·ªán test t·ª´ API Tester',
                    'start': {
                        'dateTime': tomorrow.toISOString(),
                        'timeZone': 'Asia/Ho_Chi_Minh'
                    },
                    'end': {
                        'dateTime': new Date(tomorrow.getTime() + 60 * 60 * 1000).toISOString(),
                        'timeZone': 'Asia/Ho_Chi_Minh'
                    },
                    'reminders': {
                        'useDefault': false,
                        'overrides': [
                            {'method': 'popup', 'minutes': 30}
                        ]
                    }
                };

                const request = await gapi.client.calendar.events.insert({
                    'calendarId': 'primary',
                    'resource': event
                });

                testEventId = request.result.id;
                showResult('calendarResult', 
                    `‚úÖ ƒê√£ t·∫°o s·ª± ki·ªán!\n\nEvent ID: ${testEventId}\nT√™n: ${event.summary}\nTh·ªùi gian: ${new Date(tomorrow).toLocaleString('vi-VN')}`, 
                    'success'
                );
            } catch (err) {
                showResult('calendarResult', `‚ùå L·ªói: ${err.message}`, 'error');
            }
        }

        async function testUpdateEvent() {
            if (!testEventId) {
                showResult('calendarResult', '‚ùå Vui l√≤ng t·∫°o event test tr∆∞·ªõc!', 'error');
                return;
            }

            try {
                const response = await gapi.client.calendar.events.patch({
                    'calendarId': 'primary',
                    'eventId': testEventId,
                    'resource': {
                        'summary': 'üß™ Test Event (UPDATED)',
                        'description': 'ƒê√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t l√∫c ' + new Date().toLocaleString('vi-VN')
                    }
                });

                showResult('calendarResult', `‚úÖ ƒê√£ c·∫≠p nh·∫≠t s·ª± ki·ªán!\n\n${JSON.stringify(response.result, null, 2)}`, 'success');
            } catch (err) {
                showResult('calendarResult', `‚ùå L·ªói: ${err.message}`, 'error');
            }
        }

        async function testDeleteEvent() {
            if (!testEventId) {
                showResult('calendarResult', '‚ùå Vui l√≤ng t·∫°o event test tr∆∞·ªõc!', 'error');
                return;
            }

            try {
                await gapi.client.calendar.events.delete({
                    'calendarId': 'primary',
                    'eventId': testEventId
                });

                showResult('calendarResult', `‚úÖ ƒê√£ x√≥a s·ª± ki·ªán ID: ${testEventId}`, 'success');
                testEventId = null;
            } catch (err) {
                showResult('calendarResult', `‚ùå L·ªói: ${err.message}`, 'error');
            }
        }

        // ============================================
        // TASKS API TESTS
        // ============================================
        async function testListTasks() {
            try {
                const response = await gapi.client.tasks.tasks.list({
                    'tasklist': '@default',
                    'showCompleted': true,
                    'maxResults': 10
                });

                const tasks = response.result.items || [];
                let result = `‚úÖ T√¨m th·∫•y ${tasks.length} tasks:\n\n`;
                
                tasks.forEach((task, index) => {
                    result += `${index + 1}. ${task.title}\n`;
                    result += `   Status: ${task.status === 'completed' ? '‚úÖ Ho√†n th√†nh' : '‚è≥ Ch∆∞a xong'}\n`;
                    if (task.due) {
                        result += `   üìÖ H·∫°n: ${new Date(task.due).toLocaleDateString('vi-VN')}\n`;
                    }
                    result += '\n';
                });

                showResult('tasksResult', result, 'success');
            } catch (err) {
                showResult('tasksResult', `‚ùå L·ªói: ${err.message}`, 'error');
            }
        }

        async function testCreateTask() {
            try {
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);

                const task = {
                    'title': 'üß™ Test Task from API Tester',
                    'notes': 'ƒê√¢y l√† task test, c√≥ th·ªÉ x√≥a',
                    'due': tomorrow.toISOString()
                };

                const response = await gapi.client.tasks.tasks.insert({
                    'tasklist': '@default',
                    'resource': task
                });

                testTaskId = response.result.id;
                showResult('tasksResult', 
                    `‚úÖ ƒê√£ t·∫°o task!\n\nTask ID: ${testTaskId}\nT√™n: ${task.title}\nH·∫°n: ${tomorrow.toLocaleDateString('vi-VN')}`, 
                    'success'
                );
            } catch (err) {
                showResult('tasksResult', `‚ùå L·ªói: ${err.message}`, 'error');
            }
        }

        async function testCompleteTask() {
            if (!testTaskId) {
                showResult('tasksResult', '‚ùå Vui l√≤ng t·∫°o task test tr∆∞·ªõc!', 'error');
                return;
            }

            try {
                await gapi.client.tasks.tasks.patch({
                    'tasklist': '@default',
                    'task': testTaskId,
                    'resource': {
                        'status': 'completed',
                        'completed': new Date().toISOString()
                    }
                });

                showResult('tasksResult', `‚úÖ ƒê√£ ƒë√°nh d·∫•u ho√†n th√†nh task ID: ${testTaskId}`, 'success');
            } catch (err) {
                showResult('tasksResult', `‚ùå L·ªói: ${err.message}`, 'error');
            }
        }

        async function testDeleteTask() {
            if (!testTaskId) {
                showResult('tasksResult', '‚ùå Vui l√≤ng t·∫°o task test tr∆∞·ªõc!', 'error');
                return;
            }

            try {
                await gapi.client.tasks.tasks.delete({
                    'tasklist': '@default',
                    'task': testTaskId
                });

                showResult('tasksResult', `‚úÖ ƒê√£ x√≥a task ID: ${testTaskId}`, 'success');
                testTaskId = null;
            } catch (err) {
                showResult('tasksResult', `‚ùå L·ªói: ${err.message}`, 'error');
            }
        }

        // ============================================
        // MAPS API TESTS
        // ============================================
        function testLoadMap() {
            try {
                const mapContainer = document.getElementById('mapContainer');
                mapContainer.style.display = 'block';

                map = new google.maps.Map(mapContainer, {
                    center: { lat: 10.8231, lng: 106.6297 },
                    zoom: 13
                });

                new google.maps.Marker({
                    position: { lat: 10.8231, lng: 106.6297 },
                    map: map,
                    title: 'H·ªì Ch√≠ Minh City'
                });

                showResult('mapsResult', '‚úÖ ƒê√£ load b·∫£n ƒë·ªì th√†nh c√¥ng!', 'success');
            } catch (err) {
                showResult('mapsResult', `‚ùå L·ªói: ${err.message}`, 'error');
            }
        }

        function testGeocoding() {
            try {
                const geocoder = new google.maps.Geocoder();
                geocoder.geocode({ address: 'Nh√† h√°t Th√†nh ph·ªë, H·ªì Ch√≠ Minh' }, (results, status) => {
                    if (status === 'OK') {
                        const location = results[0].geometry.location;
                        showResult('mapsResult', 
                            `‚úÖ Geocoding th√†nh c√¥ng!\n\nƒê·ªãa ch·ªâ: ${results[0].formatted_address}\nLat: ${location.lat()}\nLng: ${location.lng()}`, 
                            'success'
                        );
                    } else {
                        showResult('mapsResult', `‚ùå Geocoding failed: ${status}`, 'error');
                    }
                });
            } catch (err) {
                showResult('mapsResult', `‚ùå L·ªói: ${err.message}`, 'error');
            }
        }

        function testPlacesSearch() {
            if (!map) {
                showResult('mapsResult', '‚ùå Vui l√≤ng load map tr∆∞·ªõc!', 'error');
                return;
            }

            try {
                const service = new google.maps.places.PlacesService(map);
                service.findPlaceFromQuery({
                    query: 'Nh√† h√°t Th√†nh ph·ªë',
                    fields: ['name', 'geometry', 'formatted_address'],
                }, (results, status) => {
                    if (status === google.maps.places.PlacesServiceStatus.OK && results) {
                        showResult('mapsResult', 
                            `‚úÖ T√¨m th·∫•y ƒë·ªãa ƒëi·ªÉm!\n\n${JSON.stringify(results[0], null, 2)}`, 
                            'success'
                        );
                    } else {
                        showResult('mapsResult', `‚ùå Places search failed: ${status}`, 'error');
                    }
                });
            } catch (err) {
                showResult('mapsResult', `‚ùå L·ªói: ${err.message}`, 'error');
            }
        }

        // ============================================
        // GEMINI API TESTS
        // ============================================
        async function testGeminiChat() {
            try {
                const response = await fetch(`${CONFIG.GEMINI_API_URL}?key=${CONFIG.GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{ text: 'Xin ch√†o! B·∫°n c√≥ th·ªÉ gi√∫p t√¥i qu·∫£n l√Ω l·ªãch tr√¨nh kh√¥ng?' }]
                        }]
                    })
                });

                const data = await response.json();
                const aiResponse = data.candidates[0].content.parts[0].text;
                showResult('geminiResult', `‚úÖ Gemini ph·∫£n h·ªìi:\n\n${aiResponse}`, 'success');
            } catch (err) {
                showResult('geminiResult', `‚ùå L·ªói: ${err.message}`, 'error');
            }
        }

        async function testGeminiEventParsing() {
            try {
                const response = await fetch(`${CONFIG.GEMINI_API_URL}?key=${CONFIG.GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `Ph√¢n t√≠ch text sau v√† tr·∫£ v·ªÅ JSON format:
"H·ªçp team marketing ng√†y mai l√∫c 9 gi·ªù s√°ng t·∫°i vƒÉn ph√≤ng"

Tr·∫£ v·ªÅ format: {"name": "...", "date": "...", "time": "...", "location": "..."}`
                            }]
                        }]
                    })
                });

                const data = await response.json();
                const aiResponse = data.candidates[0].content.parts[0].text;
                showResult('geminiResult', `‚úÖ Gemini parse s·ª± ki·ªán:\n\n${aiResponse}`, 'success');
            } catch (err) {
                showResult('geminiResult', `‚ùå L·ªói: ${err.message}`, 'error');
            }
        }

        // ============================================
        // INTEGRATION TEST
        // ============================================
        async function testFullWorkflow() {
            let log = 'üöÄ B·∫Øt ƒë·∫ßu test to√†n b·ªô workflow...\n\n';
            showResult('integrationResult', log, 'success');

            try {
                // Step 1: Create event
                log += '1Ô∏è‚É£ T·∫°o s·ª± ki·ªán...\n';
                showResult('integrationResult', log, 'success');
                
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                tomorrow.setHours(14, 0, 0, 0);

                const event = {
                    'summary': 'üß™ Integration Test Event',
                    'location': 'Nh√† h√°t Th√†nh ph·ªë',
                    'start': {
                        'dateTime': tomorrow.toISOString(),
                        'timeZone': 'Asia/Ho_Chi_Minh'
                    },
                    'end': {
                        'dateTime': new Date(tomorrow.getTime() + 2 * 60 * 60 * 1000).toISOString(),
                        'timeZone': 'Asia/Ho_Chi_Minh'
                    }
                };

                const eventResponse = await gapi.client.calendar.events.insert({
                    'calendarId': 'primary',
                    'resource': event
                });
                log += `   ‚úÖ ƒê√£ t·∫°o event ID: ${eventResponse.result.id}\n\n`;
                showResult('integrationResult', log, 'success');

                // Step 2: Create task
                log += '2Ô∏è‚É£ T·∫°o task li√™n quan...\n';
                showResult('integrationResult', log, 'success');

                const task = {
                    'title': `üìã Task: ${event.summary}`,
                    'notes': 'Chu·∫©n b·ªã cho s·ª± ki·ªán',
                    'due': tomorrow.toISOString()
                };

                const taskResponse = await gapi.client.tasks.tasks.insert({
                    'tasklist': '@default',
                    'resource': task
                });
                log += `   ‚úÖ ƒê√£ t·∫°o task ID: ${taskResponse.result.id}\n\n`;
                showResult('integrationResult', log, 'success');

                // Step 3: Verify
                log += '3Ô∏è‚É£ Ki·ªÉm tra ƒë·ªìng b·ªô...\n';
                showResult('integrationResult', log, 'success');

                const eventsCheck = await gapi.client.calendar.events.list({
                    'calendarId': 'primary',
                    'timeMin': new Date().toISOString(),
                    'maxResults': 1,
                    'orderBy': 'startTime'
                });
                log += `   ‚úÖ Calendar c√≥ ${eventsCheck.result.items.length} s·ª± ki·ªán\n`;
                showResult('integrationResult', log, 'success');

                const tasksCheck = await gapi.client.tasks.tasks.list({
                    'tasklist': '@default',
                    'maxResults': 1
                });
                log += `   ‚úÖ Tasks c√≥ ${tasksCheck.result.items?.length || 0} tasks\n\n`;
                showResult('integrationResult', log, 'success');

                log += '‚úÖ HO√ÄN T·∫§T! T·∫•t c·∫£ APIs ho·∫°t ƒë·ªông t·ªët!\n';
                log += '\nKi·ªÉm tra Google Calendar v√† Google Tasks app ƒë·ªÉ xem k·∫øt qu·∫£.';
                showResult('integrationResult', log, 'success');

            } catch (err) {
                log += `\n‚ùå L·ªói: ${err.message}`;
                showResult('integrationResult', log, 'error');
            }
        }

        // ============================================
        // HELPER FUNCTIONS
        // ============================================
        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.textContent = message;
            element.className = `result ${type}`;
        }
    </script>
</body>
</html>
